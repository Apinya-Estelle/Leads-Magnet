<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แบบประเมินสภาพเส้นผม</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; }
        .question-card { display: none; }
        .question-card.active { display: block; }
        .progress-dots { display: flex; justify-content: center; gap: 12px; margin-bottom: 2rem; }
        .dot { width: 12px; height: 12px; border-radius: 50%; background-color: #d1d5db; transition: background-color 0.3s ease; }
        .dot.active { background-color: #4f46e5; }
        .image-choice input[type="radio"] { display: none; }
        .image-choice img { transition: transform 0.2s ease, box-shadow 0.2s ease; box-shadow: 0 0 0 2px #e5e7eb; border-radius: 0.75rem; }
        .image-choice input[type="radio"]:checked + label img { transform: scale(1.05); box-shadow: 0 0 0 4px #4f46e5; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="container mx-auto p-4 md:p-8 max-w-2xl">
        <div class="bg-white rounded-2xl shadow-lg p-6 md:p-10">
            <div class="text-center mb-6">
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800">ค้นหาสาเหตุผมบาง ผมร่วง</h1>
                <p class="text-gray-600 mt-2">ตอบคำถามเพื่อค้นหาสาเหตุที่แท้จริงของคุณ</p>
            </div>

            <div id="progress-dots" class="progress-dots"></div>

            <form id="hairQuizForm">
                <!-- Question 1 -->
                <div id="q1" class="question-card active">
                    <label class="block text-lg font-semibold text-gray-700 mb-4 text-center">1. สภาพเส้นผมของคุณในปัจจุบัน ตรงกับข้อไหนมากที่สุด?</label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <!-- Image Option 1 -->
                        <div class="image-choice text-center">
                            <input type="radio" id="q1_opt1" name="q1_condition" value="แนวไรผมด้านหน้าเถิก" required>
                            <label for="q1_opt1" class="cursor-pointer">
                                <img src="https://raw.githubusercontent.com/Apinya-Estelle/hair-quiz-images/main/%E0%B8%9B%E0%B8%B1%E0%B8%8D%E0%B8%AB%E0%B8%B2%201.jpg" alt="แนวไรผมด้านหน้าเถิก" class="w-full h-auto object-cover">
                                <span class="block mt-2 text-sm text-gray-700">แนวไรผมด้านหน้าเถิก</span>
                            </label>
                        </div>
                        <!-- Image Option 2 -->
                        <div class="image-choice text-center">
                            <input type="radio" id="q1_opt2" name="q1_condition" value="ผมบางลงบริเวณกลางศีรษะ">
                            <label for="q1_opt2" class="cursor-pointer">
                                <img src="https://raw.githubusercontent.com/Apinya-Estelle/hair-quiz-images/main/%E0%B8%9B%E0%B8%B1%E0%B8%8D%E0%B8%AB%E0%B8%B2%E0%B8%9C%E0%B8%A1%202.jpg" alt="ผมบางลงบริเวณกลางศีรษะ" class="w-full h-auto object-cover">
                                <span class="block mt-2 text-sm text-gray-700">ผมบางกลางศีรษะ</span>
                            </label>
                        </div>
                        <!-- ... (ตัวเลือกรูปภาพอื่นๆ ใช้รูปแบบเดียวกัน) ... -->
                        <div class="image-choice text-center">
                            <input type="radio" id="q1_opt3" name="q1_condition" value="ผมร่วงเยอะผิดปกติ">
                            <label for="q1_opt3" class="cursor-pointer">
                                <img src="https://raw.githubusercontent.com/Apinya-Estelle/hair-quiz-images/main/%E0%B8%9B%E0%B8%B1%E0%B8%8D%E0%B8%AB%E0%B8%B2%E0%B8%9C%E0%B8%A1%203.jpg" alt="ผมร่วงเยอะผิดปกติ" class="w-full h-auto object-cover">
                                <span class="block mt-2 text-sm text-gray-700">ผมร่วงเยอะผิดปกติ</span>
                            </label>
                        </div>
                         <div class="image-choice text-center">
                            <input type="radio" id="q1_opt4" name="q1_condition" value="ผมร่วงเป็นหย่อม">
                            <label for="q1_opt4" class="cursor-pointer">
                                <img src="https://raw.githubusercontent.com/Apinya-Estelle/hair-quiz-images/main/%E0%B8%9B%E0%B8%B1%E0%B8%8D%E0%B8%AB%E0%B8%B2%E0%B8%9C%E0%B8%A1%204.jpg" alt="ผมร่วงเป็นหย่อม" class="w-full h-auto object-cover">
                                <span class="block mt-2 text-sm text-gray-700">ผมร่วงเป็นหย่อม</span>
                            </label>
                        </div>
                        <div class="image-choice text-center">
                            <input type="radio" id="q1_opt5" name="q1_condition" value="ผมแห้งเสียขาดง่าย">
                            <label for="q1_opt5" class="cursor-pointer">
                                <img src="https://raw.githubusercontent.com/Apinya-Estelle/hair-quiz-images/main/%E0%B8%9B%E0%B8%B1%E0%B8%8D%E0%B8%AB%E0%B8%B2%E0%B8%9C%E0%B8%A1%205.jpg" alt="ผมแห้งเสียขาดง่าย" class="w-full h-auto object-cover">
                                <span class="block mt-2 text-sm text-gray-700">ผมแห้งเสียขาดง่าย</span>
                            </label>
                        </div>
                         <div class="image-choice text-center">
                            <input type="radio" id="q1_opt6" name="q1_condition" value="ผมบางลงโดยรวม">
                            <label for="q1_opt6" class="cursor-pointer">
                                <img src="https://raw.githubusercontent.com/Apinya-Estelle/hair-quiz-images/main/%E0%B8%9B%E0%B8%B1%E0%B8%8D%E0%B8%AB%E0%B8%B2%E0%B8%9C%E0%B8%A1%206.jpg" alt="ผมบางลงโดยรวม" class="w-full h-auto object-cover">
                                <span class="block mt-2 text-sm text-gray-700">ผมบางลงโดยรวม</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Question 2 -->
                <div id="q2" class="question-card">
                    <label class="block text-lg font-semibold text-gray-700 mb-3">2. ในช่วง 1 ปีที่ผ่านมา คุณมีพฤติกรรมเหล่านี้บ่อยแค่ไหน?</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q2_actions" value="ทำสีผม" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>กัดสีผม / ทำสีผมเป็นประจำ</span></label>
                        <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q2_actions" value="ดัด/ยืดผม" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>ดัดผม / ยืดผม (มากกว่า 2 ครั้ง/ปี)</span></label>
                        <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q2_actions" value="ใช้ความร้อน" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>เป่าผมหรือรีดผมด้วยความร้อนสูง (ทุกวัน)</span></label>
                        <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q2_actions" value="ไม่มี" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>ไม่มีพฤติกรรมข้างต้น</span></label>
                    </div>
                </div>

                <!-- Question 4 -->
                 <div id="q4" class="question-card">
                    <label class="block text-lg font-semibold text-gray-700 mb-3">3. ไลฟ์สไตล์ของคุณในช่วง 3-6 เดือนที่ผ่านมาเป็นอย่างไร? (เลือกได้หลายข้อ)</label>
                     <div class="space-y-2">
                          <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q4_lifestyle" value="เครียดสูง" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>มีความเครียดสูง / วิตกกังวล</span></label>
                          <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q4_lifestyle" value="พักผ่อนน้อย" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>พักผ่อนน้อยกว่า 6 ชั่วโมงต่อวัน</span></label>
                          <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q4_lifestyle" value="ลดน้ำหนัก" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>ลดน้ำหนักอย่างรวดเร็ว (มากกว่า 5 กก./เดือน)</span></label>
                          <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q4_lifestyle" value="เจ็บป่วย" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>เพิ่งหายจากการเจ็บป่วยรุนแรง / มีไข้สูง</span></label>
                          <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q4_lifestyle" value="ปกติ" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>ไลฟ์สไตล์ปกติ ไม่ได้มีอะไรเปลี่ยนแปลง</span></label>
                    </div>
                </div>

                <!-- Question 5 -->
                <div id="q5" class="question-card">
                    <label class="block text-lg font-semibold text-gray-700 mb-3">4. คนในครอบครัวสายตรง (พ่อ, แม่, พี่, น้อง) มีปัญหาผมบางจากพันธุกรรมหรือไม่?</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="radio" name="q5_genetics" value="มี" class="form-radio mr-3 h-5 w-5 text-indigo-600" required><span>มี</span></label>
                        <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="radio" name="q5_genetics" value="ไม่มี" class="form-radio mr-3 h-5 w-5 text-indigo-600"><span>ไม่มี</span></label>
                        <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="radio" name="q5_genetics" value="ไม่แน่ใจ" class="form-radio mr-3 h-5 w-5 text-indigo-600"><span>ไม่แน่ใจ / ไม่ทราบ</span></label>
                    </div>
                </div>

                <!-- Question 6 -->
                <div id="q6" class="question-card">
                    <label class="block text-lg font-semibold text-gray-700 mb-3">5. ในช่วง 6 เดือนที่ผ่านมา นอกจากปัญหาผมร่วง คุณมีอาการอื่นๆ เหล่านี้ร่วมด้วยหรือไม่?</label>
                    <div class="space-y-2">
                        <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors">
                            <input type="checkbox" name="q6_symptoms" value="คัน/อักเสบ" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600">
                            <span>อาการคัน, มีรังแคผิดปกติ, หรือผิวหนังบนศีรษะอักเสบแดง</span>
                        </label>
                        <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors">
                            <input type="checkbox" name="q6_symptoms" value="อ่อนเพลีย/ปวดข้อ" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600">
                            <span>อาการอ่อนเพลียผิดปกติ, ปวดตามข้อ, หรือมีผื่นแดงบนใบหน้า/ร่างกาย</span>
                        </label>
                        <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors">
                            <input type="checkbox" name="q6_symptoms" value="น้ำหนักเปลี่ยนแปลง" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600">
                            <span>น้ำหนักตัวเปลี่ยนแปลงรวดเร็วโดยไม่ทราบสาเหตุ, รู้สึกหนาว/ร้อนกว่าปกติ</span>
                        </label>
                        <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors">
                            <input type="checkbox" name="q6_symptoms" value="ไม่มี" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600">
                            <span>ไม่มีอาการเหล่านี้เลย</span>
                        </label>
                    </div>
                </div>

                <!-- Question 3 (Moved to the end) -->
                <div id="q3" class="question-card">
                    <label class="block text-lg font-semibold text-gray-700 mb-3">6. คุณดูแลปัญหาเส้นผมของคุณอย่างไรบ้าง? (เลือกได้หลายข้อ)</label>
                    <div class="space-y-2">
                          <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q3_solutions" value="แชมพูลดผมร่วง" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>ใช้แชมพู/ครีมนวด สูตรลดผมร่วง</span></label>
                          <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q3_solutions" value="ใช้เซรั่ม" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>ใช้เซรั่ม / โทนิค บำรุงหนังศีรษะ</span></label>
                          <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q3_solutions" value="ทานวิตามิน" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>ทานวิตามิน / อาหารเสริม</span></label>
                          <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q3_solutions" value="พบแพทย์" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>พบแพทย์ผิวหนัง / คลินิกเส้นผม</span></label>
                          <label class="flex items-center p-3 rounded-lg border hover:bg-gray-50 transition-colors"><input type="checkbox" name="q3_solutions" value="ไม่ได้ทำอะไร" class="form-checkbox mr-3 h-5 w-5 rounded text-indigo-600"><span>ยังไม่ได้เริ่มดูแลเป็นพิเศษ</span></label>
                    </div>
                </div>
                
                <!-- Navigation Buttons -->
                <div class="mt-8 flex justify-center gap-4">
                    <button type="button" id="prevBtn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-8 rounded-full transition duration-300" style="display: none;">ย้อนกลับ</button>
                    <button type="button" id="nextBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-full transition duration-300">ถัดไป</button>
                    <button type="submit" id="submitBtn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full transition duration-300" style="display: none;">ดูผลการประเมิน</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const questions = document.querySelectorAll('.question-card');
        const nextBtn = document.getElementById('nextBtn');
        const prevBtn = document.getElementById('prevBtn');
        const submitBtn = document.getElementById('submitBtn');
        const progressDotsContainer = document.getElementById('progress-dots');
        let currentQuestion = 0;

        questions.forEach((_, index) => {
            const dot = document.createElement('div');
            dot.classList.add('dot');
            if (index === 0) dot.classList.add('active');
            progressDotsContainer.appendChild(dot);
        });
        const dots = document.querySelectorAll('.dot');

        function updateProgress() {
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentQuestion);
            });
        }

        function showQuestion(index) {
            questions.forEach((q, i) => {
                q.classList.toggle('active', i === index);
            });
            prevBtn.style.display = index > 0 ? 'inline-block' : 'none';
            nextBtn.style.display = index < questions.length - 1 ? 'inline-block' : 'none';
            submitBtn.style.display = index === questions.length - 1 ? 'inline-block' : 'none';
            updateProgress();
        }

        function getSelectedValues(name) {
            const inputs = document.querySelectorAll(`input[name="${name}"]:checked`);
            if (inputs.length === 0) return '';
            return Array.from(inputs).map(input => input.value).join(',');
        }
        
        function validateQuestion(index) {
            const currentCard = questions[index];
            const radios = currentCard.querySelectorAll('input[type="radio"][required]');
            if (radios.length > 0 && !currentCard.querySelector('input[type="radio"]:checked')) {
                 alert('กรุณาเลือกคำตอบ');
                 return false;
            }
            const checkboxes = currentCard.querySelectorAll('input[type="checkbox"]');
            if (checkboxes.length > 0 && !currentCard.querySelector('input[type="checkbox"]:checked')) {
                 alert('กรุณาเลือกอย่างน้อย 1 คำตอบ');
                 return false;
            }
            return true;
        }

        nextBtn.addEventListener('click', () => {
             if (validateQuestion(currentQuestion) && currentQuestion < questions.length - 1) {
                 currentQuestion++;
                 showQuestion(currentQuestion);
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
            }
        });

        // --- โค้ดใหม่ที่ต้องเพิ่มเข้าไปแทนที่ ---
        document.getElementById('hairQuizForm').addEventListener('submit', function(e) {
            e.preventDefault();
            if (!validateQuestion(currentQuestion)) return;
        
            const scriptURL = 'https://script.google.com/macros/s/AKfycbzMcRESdWecIscn6r6Wx3kNGAB8trG9MZLbMP2IOVkkR9tPzfeP9ZjXt-zKFilXaHBe/exec';
            const form = document.getElementById('hairQuizForm');
            
            // สร้างข้อมูลที่จะส่งและที่จะใช้ redirect แยกกัน
            const formDataForSheet = new FormData();
            const paramsForRedirect = new URLSearchParams();
            
            // --- จัดการข้อมูลสำหรับส่ง ---

            // จัดการ Radio buttons (q1, q5)
            const radioNames = ['q1_condition', 'q5_genetics'];
            radioNames.forEach(name => {
               const checkedRadio = form.querySelector(`input[name="${name}"]:checked`);
               const value = checkedRadio ? checkedRadio.value : '';
               const key = name.split('_')[0]; // q1, q5
               formDataForSheet.append(key, value);
               paramsForRedirect.append(key, value);
            });

            // จัดการ Checkbox (q2, q3, q4, q6)
            // *** แก้ไขลำดับของ key ให้ตรงกับ Google Sheet ***
            const checkboxNames = ['q2_actions', 'q4_lifestyle', 'q6_symptoms', 'q3_solutions'];
            checkboxNames.forEach(name => {
                const values = Array.from(form.querySelectorAll(`input[name="${name}"]:checked`)).map(cb => cb.value);
                const key = name.split('_')[0]; // q2, q4, q6, q3

                if (values.length > 0) {
                    formDataForSheet.append(key, values.join(', ')); // ใช้ ", " สำหรับ Sheet เพื่อให้อ่านง่าย
                    paramsForRedirect.append(key, values.join(','));   // ใช้ "," สำหรับ URL
                } else {
                    formDataForSheet.append(key, '');
                    paramsForRedirect.append(key, '');
                }
            });
        
            // เปลี่ยนปุ่มเป็นสถานะกำลังโหลด
            const submitButton = document.getElementById('submitBtn');
            submitButton.disabled = true;
            submitButton.textContent = 'กำลังส่งข้อมูล...';
        
            // ส่งข้อมูลไปยัง Google Apps Script
            fetch(scriptURL, { method: 'POST', body: formDataForSheet})
                .then(response => response.json()) // แปลง response เป็น JSON
                .then(data => {
                    console.log('Success!', data);
                    // เมื่อส่งข้อมูลสำเร็จ ให้ redirect ไปยังหน้าผลลัพธ์
                    window.location.href = `landing_page.html?${paramsForRedirect.toString()}`;
                })
                .catch(error => {
                    console.error('Error!', error.message);
                    // หากส่งไม่สำเร็จ ให้คืนค่าปุ่มและแจ้งผู้ใช้
                    alert('เกิดข้อผิดพลาดในการส่งข้อมูล กรุณาลองใหม่อีกครั้ง');
                    submitButton.disabled = false;
                    submitButton.textContent = 'ดูผลการประเมิน';
                });
        });
            
            window.location.href = `landing_page.html?${params.toString()}`;
        });

        showQuestion(currentQuestion);
    </script>
</body>
</html>

