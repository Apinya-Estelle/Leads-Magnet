<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ผลการประเมินสภาพเส้นผมของคุณ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Container หลักสำหรับแสดงผลลัพธ์ -->
    <div id="result-container" class="min-h-screen flex items-center justify-center p-4">
        <!-- Loading State -->
        <div id="loading" class="text-center">
            <h2 class="text-xl font-semibold text-gray-700">กำลังประมวลผล...</h2>
            <p class="text-gray-500 mt-2">กรุณารอสักครู่ ระบบกำลังวิเคราะห์ข้อมูลของคุณ</p>
        </div>
    </div>

    <script>
        window.onload = function() {
            // ดึงข้อมูลคำตอบจาก URL
            const params = new URLSearchParams(window.location.search);
            const answers = {
                q1: params.get('q1_condition') || '',
                q2: (params.get('q2_actions') || '').split(','),
                q4: (params.get('q4_lifestyle') || '').split(','),
                q5: params.get('q5_genetics') || ''
            };

            const messengerLink = "http://m.me/drtophair"; // <-- ตั้งค่า Messenger Link ที่นี่

            // --- ตรรกะการให้คะแนนที่ปรับปรุงใหม่ ---
            let geneticScore = 0;
            let behaviorScore = 0;

            // วิเคราะห์ข้อ 1: สภาพเส้นผม (ตัวชี้วัดหลัก)
            if (answers.q1.includes('แนวไรผมด้านหน้าเถิก') || answers.q1.includes('ผมบางลงบริเวณกลางศีรษะ')) {
                geneticScore += 3; // สัญญาณชัดเจนของ AGA
            } else if (answers.q1.includes('ผมร่วงเป็นหย่อม')) {
                geneticScore += 2; // จัดเป็นปัจจัยภายใน (Autoimmune) ไม่ใช่พฤติกรรม
            } else if (answers.q1.includes('ผมแห้งเสียขาดง่าย')) {
                behaviorScore += 3; // สัญญาณชัดเจนของผมเสียจากภายนอก
            } else if (answers.q1.includes('ผมร่วงเยอะผิดปกติ') || answers.q1.includes('ผมบางลงโดยรวม')) {
                behaviorScore += 2; // มักเป็น Telogen Effluvium จากความเครียด/พฤติกรรม
            }

            // วิเคราะห์ข้อ 2: พฤติกรรมทำร้ายผม
            answers.q2.forEach(action => {
                if (action && (action.includes('ทำสีผม') || action.includes('ดัด/ยืดผม') || action.includes('ใช้ความร้อน'))) {
                    behaviorScore += 1;
                }
            });

            // วิเคราะห์ข้อ 4: ไลฟ์สไตล์
             answers.q4.forEach(action => {
                if (action && (action.includes('เครียดสูง') || action.includes('พักผ่อนน้อย') || action.includes('ลดน้ำหนัก') || action.includes('เจ็บป่วย'))) {
                    behaviorScore += 1;
                }
            });

            // วิเคราะห์ข้อ 5: พันธุกรรม
            if (answers.q5.includes('มี')) {
                geneticScore += 2; // ปัจจัยสนับสนุนเรื่องพันธุกรรม
            }
            
            // --- เก็บ Template ของผลลัพธ์ ---
            const resultTemplates = {
                behavior: {
                    title: "พฤติกรรม",
                    colorClass: "blue",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879a1 1 0 000 1.414l2.879 2.879a1 1 0 001.414 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M4.879 4.879L9.757 9.757m0 0L7 12.515M9.757 9.757l2.758-2.758" /></svg>`,
                    ctaText: "ปรึกษาและเลือกแนวทางให้เหมาะกับสภาพผมของคุณตอนนี้",
                    problem: "ปัญหาผมร่วง ผมบาง และผมขาดง่ายของคุณมีแนวโน้มสูงที่จะเกิดจาก 'พฤติกรรม' และปัจจัยภายนอกเป็นหลัก ซึ่งส่งผลกระทบโดยตรงต่อสุขภาพของเส้นผมและหนังศีรษะ ลักษณะเด่นคือเส้นผมจะแห้งเสีย เปราะบาง ขาดกลางเส้นได้ง่าย หรือพบว่าผมร่วงเยอะผิดปกติอย่างฉับพลันในช่วงเวลาสั้นๆ",
                    cause: "เกิดจากการทำร้ายเส้นผมโดยตรง (การใช้สารเคมี, ความร้อน) และปัจจัยด้านไลฟ์สไตล์ (ความเครียด, การพักผ่อนน้อย, ภาวะขาดสารอาหาร) ซึ่งส่งผลให้ทั้งโครงสร้างเส้นผมและรากผมอ่อนแอลง",
                    solution: "ข่าวดีคือสามารถฟื้นฟูได้ดีโดยการ 'หยุด' พฤติกรรมทำร้ายผม, 'บำรุง' อย่างล้ำลึกด้วยทรีทเม้นท์ที่เหมาะสม, และ 'ปรับ' ไลฟ์สไตล์ให้สมดุล เช่น จัดการความเครียด, นอนให้เพียงพอ, และทานอาหารที่มีประโยชน์ต่อเส้นผมโดยตรง"
                },
                genetics: {
                    title: "พันธุกรรม",
                    colorClass: "indigo",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2m14-4a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
                    ctaText: "ปรึกษาและเลือกแนวทางให้เหมาะกับสภาพผมของคุณตอนนี้",
                    problem: "ลักษณะผมบางบริเวณกลางศีรษะหรือแนวผมที่ร่นสูงขึ้น เป็นลักษณะเด่นของภาวะผมบางจากพันธุกรรม (Androgenetic Alopecia) ซึ่งเป็นสาเหตุที่พบได้บ่อยที่สุด โดยมีปัจจัยจากฮอร์โมนเพศชายเป็นตัวกระตุ้นหลัก ทำให้วงจรชีวิตของเส้นผมผิดปกติไป",
                    cause: "เกิดจากรากผมมีความไวต่อฮอร์โมน Dihydrotestosterone (DHT) ทำให้วงจรผมสั้นลง เส้นผมที่ขึ้นใหม่มีขนาดเล็กลง บางลง และสีจางลงเรื่อยๆ จนในที่สุดรากผมจะฝ่อและไม่สามารถสร้างเส้นผมใหม่ได้",
                    solution: "การรักษาควรเริ่มต้นโดยเร็วที่สุดเพื่อชะลออาการ ควรปรึกษาแพทย์ผู้เชี่ยวชาญเพื่อพิจารณาการใช้ยา เช่น Minoxidil (ยาทา) หรือ Finasteride (ยารับประทานสำหรับผู้ชาย) รวมถึงทางเลือกอื่น ๆ เช่น เลเซอร์ LLLT หรือการทำ PRP เพื่อกระตุ้นรากผม"
                }
            };

            // --- การตัดสินใจและสร้างผลลัพธ์ ---
            const resultType = (behaviorScore >= geneticScore) ? 'behavior' : 'genetics';
            const finalResult = resultTemplates[resultType];

            // สร้าง HTML แบบไดนามิก
            const resultHTML = `
                <div class="max-w-2xl w-full bg-white rounded-2xl shadow-lg p-8 md:p-10 text-center animate-fade-in">
                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-${finalResult.colorClass}-100 mb-5">
                        ${finalResult.icon}
                    </div>
                    <p class="text-sm font-semibold text-${finalResult.colorClass}-600 uppercase">ผลการประเมินเบื้องต้น</p>
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mt-2">
                        แนวโน้มผมบางจาก <span class="text-${finalResult.colorClass}-600">${finalResult.title}</span>
                    </h1>

                    <div class="text-left mt-6 space-y-4 max-w-lg mx-auto border-t pt-6">
                        <div>
                            <h3 class="font-semibold text-gray-800 text-lg">ปัญหาที่พบ:</h3>
                            <p class="text-gray-600 mt-1">${finalResult.problem}</p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800 text-lg">สาเหตุที่เป็นไปได้:</h3>
                            <p class="text-gray-600 mt-1">${finalResult.cause}</p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800 text-lg">แนวทางการดูแลเบื้องต้น:</h3>
                            <p class="text-gray-600 mt-1">${finalResult.solution}</p>
                        </div>
                    </div>

                    <div class="mt-8 bg-gray-100 rounded-xl p-6">
                        <h2 class="text-xl font-bold text-gray-800">เริ่มดูแลอย่างเป็นระบบ</h2>
                        <p class="text-gray-700 mt-2">"ให้ทุกครั้งที่สางผม เจอกับความหนานุ่ม เหมือนที่เราเคยเป็น"</p>
                        <button id="cta-button" class="w-full md:w-auto mt-5 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full transition duration-300 ease-in-out transform hover:scale-105">
                            ${finalResult.ctaText}
                        </button>
                    </div>
                </div>
            `;

            // แสดงผลลัพธ์ใน Container
            const container = document.getElementById('result-container');
            container.innerHTML = resultHTML;

            // ตั้งค่าปุ่ม CTA
            document.getElementById('cta-button').addEventListener('click', function() {
                window.open(messengerLink, '_blank');
            });
        };
    </script>
</body>
</html>
