<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ผลการประเมินสภาพเส้นผมของคุณ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Kanit', sans-serif; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Container หลักสำหรับแสดงผลลัพธ์ -->
    <div id="result-container" class="min-h-screen flex items-center justify-center p-4">
        <!-- Loading State -->
        <div id="loading" class="text-center">
            <h2 class="text-xl font-semibold text-gray-700">กำลังประมวลผล...</h2>
            <p class="text-gray-500 mt-2">กรุณารอสักครู่ ระบบกำลังวิเคราะห์ข้อมูลของคุณ</p>
        </div>
    </div>

    <script>
        window.onload = function() {
            // 1. ดึงข้อมูลคำตอบจาก URL (ใช้ key แบบใหม่)
            const params = new URLSearchParams(window.location.search);
            const answers = {
                q1: params.get('q1') || '',
                q2: (params.get('q2') || '').split(','),
                q3: (params.get('q3') || '').split(','),
                q4: (params.get('q4') || '').split(','),
                q5: params.get('q5') || '',
                q6: (params.get('q6') || '').split(',') // << ดึงข้อมูลข้อ 6
            };

            const messengerLink = "http://m.me/drtophair";

            // 2. เพิ่ม Template ของผลลัพธ์ "โรค"
            const resultTemplates = {
                behavior: {
                    title: "พฤติกรรม",
                    colorClass: "blue",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879a1 1 0 000 1.414l2.879 2.879a1 1 0 001.414 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M4.879 4.879L9.757 9.757m0 0L7 12.515M9.757 9.757l2.758-2.758" /></svg>`,
                    ctaText: "ปรึกษาเพื่อวางแผนฟื้นฟูผมเสีย",
                    problem: "ปัญหาผมร่วง ผมบาง และผมขาดง่ายของคุณมีแนวโน้มสูงที่จะเกิดจาก 'พฤติกรรม' และปัจจัยภายนอกเป็นหลัก ซึ่งส่งผลกระทบโดยตรงต่อสุขภาพของเส้นผมและหนังศีรษะ ลักษณะเด่นคือเส้นผมจะแห้งเสีย เปราะบาง ขาดกลางเส้นได้ง่าย หรือพบว่าผมร่วงเยอะผิดปกติอย่างฉับพลันในช่วงเวลาสั้นๆ",
                    cause: "เกิดจากการทำร้ายเส้นผมโดยตรง (การใช้สารเคมี, ความร้อน) และปัจจัยด้านไลฟ์สไตล์ (ความเครียด, การพักผ่อนน้อย, ภาวะขาดสารอาหาร) ซึ่งส่งผลให้ทั้งโครงสร้างเส้นผมและรากผมอ่อนแอลง",
                    solution: "ข่าวดีคือสามารถฟื้นฟูได้ดีโดยการ 'หยุด' พฤติกรรมทำร้ายผม, 'บำรุง' อย่างล้ำลึกด้วยทรีทเม้นท์ที่เหมาะสม, และ 'ปรับ' ไลฟ์สไตล์ให้สมดุล เช่น จัดการความเครียด, นอนให้เพียงพอ, และทานอาหารที่มีประโยชน์ต่อเส้นผมโดยตรง"
                },
                genetics: {
                    title: "พันธุกรรม",
                    colorClass: "indigo",
                    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2m14-4a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`,
                    ctaText: "ปรึกษาแนวทางการรักษาที่เหมาะกับคุณ",
                    problem: "ลักษณะผมบางบริเวณกลางศีรษะหรือแนวผมที่ร่นสูงขึ้น เป็นลักษณะเด่นของภาวะผมบางจากพันธุกรรม (Androgenetic Alopecia) ซึ่งเป็นสาเหตุที่พบได้บ่อยที่สุด โดยมีปัจจัยจากฮอร์โมนเพศชายเป็นตัวกระตุ้นหลัก ทำให้วงจรชีวิตของเส้นผมผิดปกติไป",
                    cause: "เกิดจากรากผมมีความไวต่อฮอร์โมน Dihydrotestosterone (DHT) ทำให้วงจรผมสั้นลง เส้นผมที่ขึ้นใหม่มีขนาดเล็กลง บางลง และสีจางลงเรื่อยๆ จนในที่สุดรากผมจะฝ่อและไม่สามารถสร้างเส้นผมใหม่ได้",
                    solution: "การรักษาควรเริ่มต้นโดยเร็วที่สุดเพื่อชะลออาการ ควรปรึกษาแพทย์ผู้เชี่ยวชาญเพื่อพิจารณาการใช้ยา เช่น Minoxidil (ยาทา) หรือ Finasteride (ยารับประทานสำหรับผู้ชาย) รวมถึงทางเลือกอื่น ๆ เช่น เลเซอร์ LLLT หรือการทำ PRP เพื่อกระตุ้นรากผม"
                },
                disease: {
                    title: "ปัญหาสุขภาพ",
                    colorClass: "red",
                    icon: `<svg class="w-8 h-8 text-red-600" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 13.1299C9 12.2899 8.35 11.6299 7.5 11.6299C6.65 11.6299 6 12.2899 6 13.1299C6 14.0499 6.83 15.1599 7.5 15.1599C8.17 15.1599 9 14.0399 9 13.1299Z" stroke="currentColor" stroke-width="1.5"></path><path d="M18 13.1299C18 12.2899 17.35 11.6299 16.5 11.6299C15.65 11.6299 15 12.2899 15 13.1299C15 14.0499 15.83 15.1599 16.5 15.1599C17.17 15.1599 18 14.0399 18 13.1299Z" stroke="currentColor" stroke-width="1.5"></path><path d="M16.5 11.63V9.37C16.5 5.86 14.49 4.5 12 4.5C9.51 4.5 7.5 5.86 7.5 9.37V11.63" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M6 13.13V16.3C6 17.8 7.2 19 8.7 19H15.3C16.8 19 18 17.8 18 16.3V13.13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>`,
                    ctaText: "ปรึกษาแพทย์เพื่อการวินิจฉัยที่ถูกต้อง",
                    problem: "ผมร่วงในลักษณะนี้มักเกิดขึ้นอย่างค่อนข้างรวดเร็ว, ร่วงในปริมาณมาก, หรือร่วงเป็นหย่อมๆ ซึ่งแตกต่างจากการบางลงอย่างช้าๆ แบบพันธุกรรม บ่อยครั้งมักมีอาการทางร่างกายอื่นๆ เกิดขึ้นร่วมด้วย ซึ่งอาการผมร่วงเปรียบเสมือน \"สัญญาณเตือน\" จากร่างกายว่ากำลังมีความผิดปกติบางอย่างเกิดขึ้น",
                    cause: "อาจเกิดจากความผิดปกติของต่อมไทรอยด์, โรคภูมิคุ้มกันทำร้ายตนเอง (เช่น โรคผมร่วงเป็นหย่อม Alopecia Areata, โรคพุ่มพวง SLE), การติดเชื้อบนหนังศีรษะ, หรือภาวะขาดสารอาหารรุนแรง (เช่น ภาวะโลหิตจางจากการขาดธาตุเหล็ก)",
                    solution: "นี่คือขั้นตอนที่สำคัญที่สุด ควรเข้าพบแพทย์อายุรกรรมหรือแพทย์ผิวหนังเพื่อทำการตรวจเลือดหรือตรวจร่างกายอย่างละเอียดเพื่อวินิจฉัยโรคต้นเหตุ การรักษาอาการผมร่วงจะเริ่มได้ก็ต่อเมื่อโรคที่เป็นสาเหตุหลักได้รับการควบคุมแล้ว"
                }
            };

            let resultType = '';

            // ขั้นตอนที่ 1: ตรวจสอบอาการของโรคก่อนเสมอ
            const hasDiseaseSymptoms = answers.q6.some(symptom =>
                symptom.includes('คัน/อักเสบ') ||
                symptom.includes('อ่อนเพลีย/ปวดข้อ') ||
                symptom.includes('น้ำหนักเปลี่ยนแปลง')
            );

            if (hasDiseaseSymptoms) {
                resultType = 'disease';
            } else {
                // ขั้นตอนที่ 2: หากไม่เข้าข่ายโรค ให้คำนวณคะแนนตามปกติ
                let geneticScore = 0;
                let behaviorScore = 0;

                // วิเคราะห์ข้อ 1
                if (answers.q1.includes('แนวไรผมด้านหน้าเถิก') || answers.q1.includes('ผมบางลงบริเวณกลางศีรษะ')) {
                    geneticScore += 3;
                } else if (answers.q1.includes('ผมร่วงเป็นหย่อม')) {
                    geneticScore += 2;
                } else if (answers.q1.includes('ผมแห้งเสียขาดง่าย')) {
                    behaviorScore += 3;
                } else if (answers.q1.includes('ผมร่วงเยอะผิดปกติ') || answers.q1.includes('ผมบางลงโดยรวม')) {
                    behaviorScore += 2;
                }

                // วิเคราะห์ข้อ 2
                answers.q2.forEach(action => {
                    if (action && (action.includes('ทำสีผม') || action.includes('ดัด/ยืดผม') || action.includes('ใช้ความร้อน'))) {
                        behaviorScore += 1;
                    }
                });

                // วิเคราะห์ข้อ 4
                answers.q4.forEach(action => {
                    if (action && (action.includes('เครียดสูง') || action.includes('พักผ่อนน้อย') || action.includes('ลดน้ำหนัก') || action.includes('เจ็บป่วย'))) {
                        behaviorScore += 1;
                    }
                });

                // วิเคราะห์ข้อ 5
                if (answers.q5.includes('มี')) {
                    geneticScore += 2;
                }

                // ขั้นตอนที่ 3: ตัดสินระหว่าง พฤติกรรม vs พันธุกรรม
                resultType = (behaviorScore >= geneticScore) ? 'behavior' : 'genetics';
            }

            const finalResult = resultTemplates[resultType];

            // สร้าง HTML (ส่วนนี้ไม่ต้องแก้ไข)
            const resultHTML = `
                <div class="max-w-2xl w-full bg-white rounded-2xl shadow-lg p-8 md:p-10 text-center animate-fade-in">
                    <div class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-${finalResult.colorClass}-100 mb-5">
                        ${finalResult.icon}
                    </div>
                    <p class="text-sm font-semibold text-${finalResult.colorClass}-600 uppercase">ผลการประเมินเบื้องต้น</p>
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mt-2">
                        แนวโน้มจาก <span class="text-${finalResult.colorClass}-600">${finalResult.title}</span>
                    </h1>
                        <div class="text-left mt-6 space-y-4 max-w-lg mx-auto border-t pt-6">
                        <div>
                            <h3 class="font-semibold text-gray-800 text-lg">ปัญหาที่พบ:</h3>
                            <p class="text-gray-600 mt-1">${finalResult.problem}</p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800 text-lg">สาเหตุที่เป็นไปได้:</h3>
                            <p class="text-gray-600 mt-1">${finalResult.cause}</p>
                        </div>
                        <div>
                            <h3 class="font-semibold text-gray-800 text-lg">แนวทางการดูแลเบื้องต้น:</h3>
                            <p class="text-gray-600 mt-1">${finalResult.solution}</p>
                        </div>
                    </div>
                    <div class="mt-8 bg-gray-100 rounded-xl p-6">
                        <h2 class="text-xl font-bold text-gray-800">เริ่มดูแลอย่างเป็นระบบ</h2>
                        <p class="text-gray-700 mt-2">"ให้ทุกครั้งที่สางผม เจอกับความหนานุ่ม เหมือนที่เราเคยเป็น"</p>
                        <button id="cta-button" class="w-full md:w-auto mt-5 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-8 rounded-full transition duration-300 ease-in-out transform hover:scale-105">
                            ${finalResult.ctaText}
                        </button>
                    </div>
                </div>`;

            const container = document.getElementById('result-container');
            container.innerHTML = resultHTML;

            document.getElementById('cta-button').addEventListener('click', function() {
                window.open(messengerLink, '_blank');
            });
        };
    </script>
</body>
</html>
